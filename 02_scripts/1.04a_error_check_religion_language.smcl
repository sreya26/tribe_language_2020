{smcl}
{txt}{sf}{ul off}{.-}
      name:  {res}plog_778
       {txt}log:  {res}/Users/sreyamajumder/Dropbox/sreya_majumder/tribelanguage_2020 sreya/02_scripts/1.04a_error_check_religion_language.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res} 7 Sep 2021, 17:26:47
{txt}
{com}. 
. project, uses("../08_temp/census1961_st_religion_data.dta")
{txt}project version2_tribe_language > do-file uses: {res}"08_temp/census1961_st_religion_data.dta" filesig(919938569:5810751){txt}

{com}. project, uses("../08_temp/census1961_st_mothertongue.dta")
{txt}project version2_tribe_language > do-file uses: {res}"08_temp/census1961_st_mothertongue.dta" filesig(1104297003:25208159){txt}

{com}. project, uses("../08_temp/census1961_st_mothertongue_distcoded.dta")
{txt}project version2_tribe_language > do-file uses: {res}"08_temp/census1961_st_mothertongue_distcoded.dta" filesig(3162696187:20487697){txt}

{com}.         
.         
.         *************************************************************************************************************************
.         * ERROR CHECKS FOR RELIGION DATA 
.         *************************************************************************************************************************
.         
.         *************************************************************************************************************************
.         * for religion data: 
.         * 1. to check gender wise row totals 
.         * 2. to check whether districts within a division sum up to the figures stated for the division 
.         *************************************************************************************************************************
.         
.         use "../08_temp/census1961_st_religion_data.dta", clear
{txt}
{com}.         
.         *************************************************************************************************************************
.         ** gender-wise row totals 
.         *************************************************************************************************************************
.         
.         local gender f m 
{txt}
{com}.         
.         foreach x of local gender {c -(}
{txt}  2{com}.                 ds *_`x'
{txt}  3{com}.                 local vars `r(varlist)'
{txt}  4{com}.                 local exclude total_`x'
{txt}  5{com}.                 local vars: list vars - exclude
{txt}  6{com}.                 egen double tot_`x' = rowtotal(`vars')
{txt}  7{com}.                 assert tot_`x' == total_`x'
{txt}  8{com}.         {c )-}
{txt}{col 1}total_f{col 15}hindu_f{col 29}paharia_f{col 43}tirkia_f{col 57}konyak_f{col 71}kabirpanth~f{col 85}other_pers~f{col 99}kachari_f{col 113}mizo_f
{col 1}buddhist_f{col 15}jain_f{col 29}santal_f{col 43}religion_n~f{col 57}lumbasabo_f{col 71}zoroastria~f{col 85}boro_f{col 99}khasi_f{col 113}naga_f
{col 1}chandobong~f{col 15}marangburu_f{col 29}saridharma_f{col 43}sarna_f{col 57}wancho_f{col 71}ho_f{col 85}garo_f{col 99}miri_f{col 113}animist_f
{col 1}christian_f{col 15}muslim_f{col 29}sikh_f{col 43}chang_naga_f{col 57}yimchunger_f{col 71}sansari_f{col 85}hajong_f{col 99}mikir_f{col 113}indefinite~f
{col 1}total_m{col 15}hindu_m{col 29}paharia_m{col 43}tirkia_m{col 57}konyak_m{col 71}kabirpanth~m{col 85}other_pers~m{col 99}kachari_m{col 113}mizo_m
{col 1}buddhist_m{col 15}jain_m{col 29}santal_m{col 43}religion_n~m{col 57}lumbasabo_m{col 71}zoroastria~m{col 85}boro_m{col 99}khasi_m{col 113}naga_m
{col 1}chandobong~m{col 15}marangburu_m{col 29}saridharma_m{col 43}sarna_m{col 57}wancho_m{col 71}ho_m{col 85}garo_m{col 99}miri_m{col 113}animist_m
{col 1}christian_m{col 15}muslim_m{col 29}sikh_m{col 43}chang_naga_m{col 57}yimchunger_m{col 71}sansari_m{col 85}hajong_m{col 99}mikir_m{col 113}indefinite~m

{com}.         
.         *************************************************************************************************************************
.         ** ensuring that total_m + total_f = total_p
.         *************************************************************************************************************************
.         
.         egen tot_p = rowtotal(total_m total_f)
{txt}
{com}.         assert total_p == tot_p
{txt}
{com}.         
.         *************************************************************************************************************************       
.         ** check for districts within a division
.         *************************************************************************************************************************
.         
.         keep if division_code > 0 & !missing(division_code)
{txt}(3,364 observations deleted)

{com}.         
.         gen byte weight_div = 1 if strpos(district,"Division")>0
{txt}(2,528 missing values generated)

{com}.         replace weight_div = -1 if missing(weight_div)
{txt}(2,528 real changes made)

{com}.         
.         foreach var of varlist *_m *_f {c -(}
{txt}  2{com}.                 egen `var'_error = total(`var'*weight_div), by (state division_code tribe area)
{txt}  3{com}.                 assert `var'_error == 0
{txt}  4{com}.         {c )-}
{txt}
{com}.         
.         
.         *************************************************************************************************************************
.         * ERROR CHECKS FOR LANGUAGE DATA
.         *************************************************************************************************************************
. 
.         *************************************************************************************************************************
.         * gender-wise totals for sl speakers (districts and divisions)
.         *************************************************************************************************************************
.         
.         use     "../08_temp/census1961_st_mothertongue.dta",clear
{txt}
{com}.         
.         foreach x in m f {c -(}
{txt}  2{com}.                 replace subsidiary_speakers_total_`x' = 0 if missing(subsidiary_speakers_total_`x')
{txt}  3{com}.                 egen subsidiary_total_`x' = rowtotal(sl_*_`x')
{txt}  4{com}.                 gen subsidiary_error_`x' = subsidiary_total_`x' - subsidiary_speakers_total_`x'
{txt}  5{com}.         {c )-}
{txt}(6,574 real changes made)
(8,627 real changes made)

{com}.         
.         tempfile mothertongue_data
{txt}
{com}.         save `mothertongue_data'
{txt}{p 0 4 2}
file {bf}
/var/folders/m0/4lyk4gcd0rs88ghc7sdnwc600000gn/T//S_13929.000006{rm}
saved
as .dta format
{p_end}

{com}.         
.         assert subsidiary_error_m == 0 
{txt}
{com}.         assert subsidiary_error_f ==0 
{txt}
{com}.         
.         
.         *************************************************************************************************************************
.         * check to see whether districts within a division sum up to the division obs
.         *************************************************************************************************************************
.         
.         
.         keep if division_code > 0 & !missing(division_code) | sub_division_code > 0 & !missing(sub_division_code)
{txt}(7,383 observations deleted)

{com}.         
.         rename sl_ceylonesesimelusinghalese_m sl_ceylonese_m //renaming some sl languages to generate valid error names othw strings are too long
{res}{txt}
{com}.         rename sl_ceylonesesimelusinghalese_f sl_ceylonese_f
{res}{txt}
{com}.         
.         rename sl_nagpuri_eastern_magahi_m sl_nagpuri_m
{res}{txt}
{com}.         rename sl_nagpuri_eastern_magahi_f sl_nagpuri_f
{res}{txt}
{com}.         
.         gen byte weight_div = 1 if strpos(district,"Division")>0 & state != "Tripura"
{txt}(6,970 missing values generated)

{com}.         replace weight_div = -1 if strpos(district,"Division") == 0 & !inlist(state,"Tripura","Manipur") //Manipur and Tripur have no divisions 
{txt}(6,111 real changes made)

{com}.         
.         egen error_division_m = total(total_speakers_m*weight_div), by (state division_code tribe mothertongue)
{txt}
{com}.         egen error_division_f = total(total_speakers_f*weight_div), by (state division_code tribe mothertongue)
{txt}
{com}.         
.         egen error_division_sub_m = total(subsidiary_speakers_total_m*weight_div), by (state division_code tribe mothertongue)
{txt}
{com}.         egen error_division_sub_f = total(subsidiary_speakers_total_f*weight_div), by (state division_code tribe mothertongue)
{txt}
{com}. 
.         assert error_division_m == 0 
{txt}
{com}.         assert error_division_f == 0 
{txt}
{com}.         assert error_division_sub_m == 0 
{txt}
{com}.         assert error_division_sub_f == 0 
{txt}
{com}.         
.         *************************************************************************************************************************
.         ** Checks for sub-divisions
.         ** For Manipur: Mao and Sadar Hills figures should sum to those stated for Mao & Sadar Hills
.         ** Tripura only has sub-divisions, these figures should sum to those stated for State level obs
.         *************************************************************************************************************************
.         
.         gen byte weight_sub = 1 if district == "Mao & Sadar Hills" | district == "Tripura"
{txt}(9,995 missing values generated)

{com}.         replace weight_sub = -1 if district == "Mao" | district == "Sadar Hills" | strpos(tribe,"Sub-Division")>0  
{txt}(39 real changes made)

{com}.         
.         
.         egen error_sub_m = total(total_speakers_m*weight_sub), by (state sub_division_code tribe mothertongue)
{txt}
{com}.         egen error_sub_f = total(total_speakers_f*weight_sub), by (state sub_division_code tribe mothertongue)
{txt}
{com}.         
.         egen error_subdiv_sub_m = total(subsidiary_speakers_total_m*weight_sub), by (state sub_division_code tribe mothertongue)
{txt}
{com}.         egen error_subdiv_sub_f = total(subsidiary_speakers_total_f*weight_sub), by (state sub_division_code tribe mothertongue)
{txt}
{com}.         
.         assert error_sub_m == 0
{txt}
{com}.         assert error_sub_f == 0
{txt}
{com}.         
.         assert error_subdiv_sub_m == 0
{txt}
{com}.         assert error_subdiv_sub_m == 0
{txt}
{com}.         
.         foreach var of varlist sl_* {c -(}
{txt}  2{com}.                 egen `var'_sub = total(`var'*weight_sub) , by(state sub_division_code tribe mothertongue)
{txt}  3{com}.                 assert `var'_sub == 0
{txt}  4{com}.                 
.         {c )-}
{txt}
{com}.         
.         drop *_sub
{txt}
{com}.         
.         *************************************************************************************************************************
.         ** additional check for whether all sl speakers in a division is the sum of its constituent district figures
.         *************************************************************************************************************************
.         
.         drop if state == "Manipur" | state == "Tripura" // dropping manipur and tripura since they only have sub-divisions
{txt}(859 observations deleted)

{com}.         
. 
.         foreach var of varlist sl_* {c -(}
{txt}  2{com}.                 egen `var'_error = total(`var'*weight_div) , by(state division_code tribe mothertongue)
{txt}  3{com}.                 assert `var'_error == 0
{txt}  4{com}.         {c )-}
{txt}
{com}. 
.         
.         **********************************************************************************************************************************************
.         * Some states give us total mother tongue information in the tables, checking if sum of individual mother tongues for each tribe sums to this
.         **********************************************************************************************************************************************
.         
.         use `mothertongue_data' , clear 
{txt}
{com}.         
.         gen byte weight = 1 if mothertongue == "total" | mothertongue == "all mother tongues"
{txt}(16,427 missing values generated)

{com}.         replace weight = -1 if missing(weight)
{txt}(16,427 real changes made)

{com}.         
.         
.         egen error_m = total(total_speakers_m*weight) , by(state district tribe)
{txt}
{com}.         egen error_f = total(total_speakers_f*weight) , by(state district tribe)
{txt}
{com}.         
.         keep if inlist(state, "West Bengal", "Tripura","Rajasthan", "Maharashtra","Himachal Pradesh")
{txt}(10,509 observations deleted)

{com}.         
.         drop if tribe != "all scheduled tribes" & inlist(state,"Tripura","Rajasthan")
{txt}(1,028 observations deleted)

{com}.         
.         keep state district tribe mothertongue total_speakers_m total_speakers_f error_m error_f
{txt}
{com}.         drop if strpos(tribe,"aggregate")>0
{txt}(34 observations deleted)

{com}.         
.         drop if tribe == "all scheduled tribes" & state == "West Bengal" //useless for us since we don't have language-wise information for "all scheduled tribes"
{txt}(19 observations deleted)

{com}.         drop if tribe == "all scheduled tribes" & state == "Himachal Pradesh" //useless for us since we don't have language-wise information for "all scheduled tribes"
{txt}(7 observations deleted)

{com}.         
.         assert error_m == 0
{txt}
{com}.         assert error_f == 0
{txt}
{com}.         
.         
.         *************************************************************************************************************************
.         * checks to ensure that gender-wise total popn figures match across religion and mother-tongue data
.         *************************************************************************************************************************
.         use `mothertongue_data', clear
{txt}
{com}.         
.         foreach var of varlist total_speakers_m-total_speakers_f {c -(}
{txt}  2{com}.                 replace `var' = 0 if missing(`var')
{txt}  3{com}.         {c )-}
{txt}(1,606 real changes made)
(2,937 real changes made)

{com}.         
.         drop if strpos(tribe,"aggregate")>0 
{txt}(34 observations deleted)

{com}.         replace district = subinstr(district,"Island","Islands",1) if state == "Andaman & Nicobar Islands" & district != "Andaman & Nicobar Islands"
{txt}(11 real changes made)

{com}.         replace district = "Bilas Division" if district == "Bilaspur Division" & state == "Madhya Pradesh"
{txt}(237 real changes made)

{com}. 
.         
.         drop if mothertongue == "total" | mothertongue == "all mother tongues" //to account for double counting
{txt}(976 observations deleted)

{com}.         drop if total_speakers_m == 0 & total_speakers_f == 0
{txt}(0 observations deleted)

{com}.         
.         
.         collapse (sum) total_speakers_m total_speakers_f, by(state district tribe)
{res}{txt}
{com}.         rename total_speakers_? total_speakers?_lang
{res}{txt}
{com}.         
.                 
.         tempfile mothertongue
{txt}
{com}.         save `mothertongue'
{txt}{p 0 4 2}
file {bf}
/var/folders/m0/4lyk4gcd0rs88ghc7sdnwc600000gn/T//S_13929.000007{rm}
saved
as .dta format
{p_end}

{com}.         
.         *************************************************************************************************************************
.         * preparing religion data 
.         *************************************************************************************************************************
.         
.         use "../08_temp/census1961_st_religion_data.dta", clear
{txt}
{com}.         drop if strpos(tribe,"aggregate") > 0 
{txt}(10 observations deleted)

{com}.         
.         drop if district == "Imphal Town" //this is redundant we already have Manipur urban obs
{txt}(25 observations deleted)

{com}.         
.         replace district = strrtrim(district)
{txt}(0 real changes made)

{com}.         drop if area == "total" //mp has urban rural and total area
{txt}(49 observations deleted)

{com}.         
.         replace district = "Imphal West" if district == "Imphal Town part of Imphal West"
{txt}(25 real changes made)

{com}.         replace district = "Imphal East" if district == "Imphal Town part of Imphal East"
{txt}(12 real changes made)

{com}.         replace district = proper(district) if state == "Laccadive, Minicoy and Amindivi Islands" & state != district 
{txt}(20 real changes made)

{com}.         drop if tribe == "all scheduled tribes"  & state == "Laccadive, Minicoy and Amindivi Islands"
{txt}(11 observations deleted)

{com}.         
.         collapse (sum) total_m total_f, by(state district tribe)
{res}{txt}
{com}.         
.         keep state district tribe total_m total_f
{txt}
{com}.         
.         merge 1:1 state district tribe using `mothertongue', assert(match master)
{res}
{txt}{col 5}Result{col 33}Number of obs
{col 5}{hline 41}
{col 5}Not matched{col 30}{res}             133
{txt}{col 9}from master{col 30}{res}             133{txt}  (_merge==1)
{col 9}from using{col 30}{res}               0{txt}  (_merge==2)

{col 5}Matched{col 30}{res}           4,142{txt}  (_merge==3)
{col 5}{hline 41}

{com}.         
.         **unmatched are all scheduled tribes obs only from religion data since we do not have this reported consistently in the mother tongue data
.         
.         assert tribe == "all scheduled tribes" if _merge == 1
{txt}
{com}.         keep if _merge == 3
{txt}(133 observations deleted)

{com}.         
.         drop if tribe == "all scheduled tribes" & state == "Gujarat" //Gujarat does not consistently report numbers for all scheduled tribes, missing for when only one tribe is listed for the mothertongue
{txt}(20 observations deleted)

{com}.         
.         
.         assert total_m == total_speakersm_lang
{txt}
{com}.         assert total_f == total_speakersf_lang
{txt}
{com}. 
.         *************************************************************************************************************************
.         * checks for district totals summing to the state level figures
.         *************************************************************************************************************************
.         
.         use "../08_temp/census1961_st_mothertongue_distcoded.dta", clear
{txt}
{com}. 
.         gen is_state = mod(dcode_1961,100) 
{txt}
{com}.         
.         drop if strpos(tribe,"aggregate")>0
{txt}(34 observations deleted)

{com}.         drop if tribe == "all scheduled tribes" & state_1961 == "Manipur" //manipur all scheduled tribe total mother tongue data only at state level 
{txt}(1 observation deleted)

{com}.                 
. 
.         *** district totals of total speakers summing up to the state level
.         
.         gen byte weight = 1 if is_state == 0
{txt}(10,052 missing values generated)

{com}.         replace weight = -1 if missing(weight)
{txt}(10,052 real changes made)

{com}. 
.         egen error_totalm = total(total_speakers_m*weight) , by(state_1961 tribe)
{txt}
{com}.         egen error_totalf = total(total_speakers_f*weight) , by(state_1961 tribe)
{txt}
{com}. 
.         assert error_totalm == 0  
{txt}
{com}.         assert error_totalf == 0
{txt}
{com}.         
.         *************************************************************************************************************************
.         * checks for whether subsidiary tot_popn sums to state 
.         *************************************************************************************************************************
.         
.         egen error_total_subsidiary_m = total(subsidiary_speakers_total_m*weight) , by(state_1961 tribe)
{txt}
{com}.         egen error_total_subsidiary_f = total(subsidiary_speakers_total_f*weight) , by(state_1961 tribe)
{txt}
{com}.         
.         assert error_total_subsidiary_m == 0 if state_1961 != "Orissa" // Orissa has missing obs for speakers of sl languages who constitute less than 1% of population
{txt}
{com}.         assert error_total_subsidiary_f == 0 if state_1961 != "Orissa"
{txt}
{com}.         
.         
.         drop if state_1961 == "Orissa" //not retaining Orissa for checks for each sl language 
{txt}(1,431 observations deleted)

{com}.         
.         rename sl_ceylonesesimelusinghalese_m sl_ceylonese_m //renaming some sl languages to generate valid error names
{res}{txt}
{com}.         rename sl_ceylonesesimelusinghalese_f sl_ceylonese_f
{res}{txt}
{com}.         
.         rename sl_nagpuri_eastern_magahi_m sl_nagpuri_m
{res}{txt}
{com}.         rename sl_nagpuri_eastern_magahi_f sl_nagpuri_f
{res}{txt}
{com}. 
.         foreach var of varlist sl_* {c -(}
{txt}  2{com}.                 egen `var'_error = total(`var'*weight) , by(state_1961 tribe)
{txt}  3{com}.                 assert `var'_error == 0
{txt}  4{com}.         {c )-}
{txt}
{com}.         
.         
. 
.         
. 
.         
. 
.         
.         
.         
.         
.                 
.         
.         
.         
.         
.         
.         
. 
{txt}end of do-file
      name:  {res}plog_778
       {txt}log:  {res}/Users/sreyamajumder/Dropbox/sreya_majumder/tribelanguage_2020 sreya/02_scripts/1.04a_error_check_religion_language.smcl
  {txt}log type:  {res}smcl
 {txt}closed on:  {res} 7 Sep 2021, 17:27:23
{txt}{.-}
{smcl}
{txt}{sf}{ul off}